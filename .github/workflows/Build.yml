name: Build

jobs:
  Build:
    runs-on: ${{ matrix.os }}

    env:
      CMAKE_BUILD_PARALLEL_LEVEL: "2"
      CMAKE_GENERATOR: 'Ninja'

    strategy:
      fail-fast: false
      matrix:
        os: ["windows-2019", "windows-2016"]

    steps:
      - name: Checkout
        uses: actions/checkout@v2.3.4

      - name: Install cmake
        uses: lukka/get-cmake@v3.19.2

      - name: Install
        shell: powershell
        run: |
          # Install scoop
          Invoke-Expression (New-Object System.Net.WebClient).DownloadString('https://get.scoop.sh')

          scoop install ninja --global

      - name: Setup msvc dev
        uses: ilammy/msvc-dev-cmd@v1.7.0

      - name: Configure build directory
        run: |
          mkdir build
          cd build
          cmake -DCMAKE_VERBOSE_MAKEFILE=ON -A Win32 ..

      - name: Build Debug
        shell: bash
        run: |
          cd build

          cmake .. -DCMAKE_BUILD_TYPE=Debug
          cmake --build . --config "Debug" --clean-first

      - name: Build DebugPreyRun
        run: |
          cd build
          cmake .. -DCMAKE_BUILD_TYPE=DebugPreyRun
          cmake --build . --config "DebugPreyRun" --clean-first

      - name: Build Release
        run: |
          cd build
          cmake .. -DCMAKE_BUILD_TYPE=Release
          cmake --build . --config "Release" --clean-first
